<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>Testing Sds/Common/Validator/ModelValidator</title>
        <script type="text/javascript" src="../../testconfig.js"></script>
        <script type="text/javascript" src="../../../../dojo/dojo.js"></script>
		<script type="text/javascript">
            require([
                    'doh/main',
                    'dojo/when',
                    'dojo/Deferred',
                    'Sds/Common/Validator/ModelValidator',
                    'Sds/Test/Common/Validator/Asset/TestModel',
                    'dojo/domReady!'
                ],
                function(
                    doh,
                    when,
                    Deferred,
                    ModelValidator,
                    TestModel
                ){
                    doh.register("Sds/Test/Common/Validator/TestModelValidator", [

                        function ValidatorTest(doh){

                            var resultDeferred = new Deferred;

                            var validator = new ModelValidator({metadata: TestModel.metadata});

                            var testArray = [
                                //[true, new TestModel({firstname: 'Liz', lastname: 'Emma', email: 'mim@here.com'})],
                                [false, new TestModel({firstname: 'Miriam', lastname: 'Emma', email: 'mim@here.com'})],
                                [false, new TestModel({firstname: null, lastname: 'Emma', email: 'mim@here.com'})]//,
                                //[false, new TestModel({firstname: 'Tim', lastname: 'E', email: 'here.com'})]
                            ];
                            var count = 0;

                            var index;
                            for (index in testArray){
                                if (testArray[index][0]){
                                    when(validator.isValid(testArray[index][1]), function(result){
                                        console.dir(validator.get('messages'));
                                        doh.assertTrue(result);
                                        ++count;
                                        if (count > testArray.length){resultDeferred.resolve(true)}
                                    })
                                } else {
                                    when(validator.isValid(testArray[index][1]), function(result){
                                        console.dir(validator.get('messages'));
                                        doh.assertFalse(result);
                                        ++count;
                                        if (count > testArray.length){resultDeferred.resolve(true)}
                                    })
                                }
                            }

                            return resultDeferred;
                        }
                    ]);

                    doh.runOnLoad();
                }
            );

		</script>
	</head>
	<body>
        <h1>Testing Sds/Common/Validator/ModelValidator</h1>
	</body>
</html>
