<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>Testing Sds/Common/Validator/ValidatorGroup</title>
		<script
            type="text/javascript"
            src="../../../../dojo/dojo.js"
            data-dojo-config="
                isDebug: true,
                popup: true,
                async: true
            ">
        </script>
		<script type="text/javascript">
            require([
                    'doh/main',
                    'dojo/Deferred',
                    'Sds/Common/Validator/DatatypeValidator',
                    'Sds/Common/Validator/IdentifierValidator',
                    'Sds/Common/Validator/ValidatorGroup',
                    'Sds/Test/Common/Validator/Asset/DeferredValidator',
                    'dojo/domReady!'
                ],
                function(
                    doh,
                    Deferred,
                    DatatypeValidator,
                    IdentifierValidator,
                    ValidatorGroup,
                    DeferredValidator
                ){
                    doh.register("Sds/Test/Common/Validator/TestValidatorGroup", [

                        function ValidatorTest(doh){

                            var validator = new ValidatorGroup([
                                new DatatypeValidator(DatatypeValidator.datatypes.STRING),
                                new IdentifierValidator()
                            ]);

                            var testArray = [
                                [true, 'username'],
                                [false, 'u'],
                                [false, 1233456]
                            ];

                            var index;
                            for (index in testArray){
                                if (testArray[index][0]){
                                    doh.assertTrue(validator.isValid(testArray[index][1]));
                                } else {
                                    doh.assertFalse(validator.isValid(testArray[index][1]));
                                }
                            }
                        },

                        function deferredValidatorTest(doh){

                            var deferredTest = new Deferred;

                            var validator = new ValidatorGroup([
                                new DeferredValidator(),
                                new DatatypeValidator(DatatypeValidator.datatypes.STRING),
                            ]);

                            var testArray = [
                                [true, 'username'],
                                [true, 'u'],
                                [false, 1233456]
                            ];

                            var index;
                            for (index in testArray){
                                if (testArray[index][0]){
                                    validator.isValid(testArray[index][1]).then(function(result){
                                        doh.assertTrue(result);
                                        deferredTest.resolve(true);
                                    })
                                } else {
                                    validator.isValid(testArray[index][1]).then(function(result){
                                        doh.assertFalse(result);
                                        deferredTest.resolve(true);
                                    })
                                }
                            }

                            return deferredTest;
                        }
                    ]);

                    doh.runOnLoad();
                }
            );

		</script>
	</head>
	<body>
        <h1>Testing Sds/Common/Validator/ValidatorGroup</h1>
	</body>
</html>
