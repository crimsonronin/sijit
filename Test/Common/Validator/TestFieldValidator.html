<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>
		<title>Testing Sds/Common/Validator/FieldValidator</title>
        <script type="text/javascript" src="../../testconfig.js"></script>
        <script type="text/javascript" src="../../../../dojo/dojo.js"></script>
		<script type="text/javascript">
            require([
                    'doh/main',
                    'dojo/when',
                    'dojo/Deferred',
                    'Sds/Common/Validator/FieldValidator',
                    'Sds/Test/Common/Validator/Asset/TestModel',
                    'dojo/domReady!'
                ],
                function(
                    doh,
                    when,
                    Deferred,
                    FieldValidator,
                    TestModel
                ){
                    doh.register("Sds/Test/Common/Validator/TestFieldValidator", [

                        function ValidatorTest(doh){

                            var resultDeferred = new Deferred;

                            var validator = new FieldValidator({metadata: TestModel.metadata.fields.firstname});

                            var testArray = [
                                [true, 'Tim'],
                                [false, 'T'],
                                [false, 'Timothy']//,
                                //[false, null]
                            ];
                            var count = 0;

                            var doIsValid = function(correctResult, value){
                                when(validator.isValid(value), function(result){
                                    console.debug(correctResult);
                                    console.debug(validator.get('messages'));
                                    doh.assertEqual(correctResult, result);
                                    ++count;
                                    if (count > testArray.length){resultDeferred.resolve(true)}
                                })
                            }

                            var index;
                            for (index in testArray){
                                doIsValid(testArray[index][0], testArray[index][1]);
                            }

                            return resultDeferred;
                        }
                    ]);

                    doh.runOnLoad();
                }
            );

		</script>
	</head>
	<body>
        <h1>Testing Sds/Common/Validator/FieldValidator</h1>
	</body>
</html>
